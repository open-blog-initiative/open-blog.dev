<!DOCTYPE html><html lang="en" amp><head><script async src="https://cdn.ampproject.org/v0.js"></script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="generator" content="Gatsby 2.8.2"><title data-react-helmet="true">Using React Hooks |  Open blog</title><link data-react-helmet="true" rel="canonical" href="https://medium.zenika.com/using-react-hooks-871d5337d035"><link data-react-helmet="true" rel="amphtml" href="https://open-blog.dev/amp/posts/swiip/using-react-hooks/"><meta data-react-helmet="true" name="description" content="The followup of my article describing React Hooks"><meta data-react-helmet="true" property="og:title" content="Using React Hooks"><meta data-react-helmet="true" property="og:description" content="The followup of my article describing React Hooks"><meta data-react-helmet="true" property="og:type" content="website"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="twitter:creator" content="Matthieu Lux"><meta data-react-helmet="true" name="twitter:title" content="Using React Hooks"><meta data-react-helmet="true" name="twitter:description" content="The followup of my article describing React Hooks"><meta data-react-helmet="true" property="og:image" content="https://open-blog.dev/static/2cb9b06296b623620a429783b7e127f9/8539d/fishing.jpg"><script data-react-helmet="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://open-blog.dev//posts/swiip/using-react-hooks/"},"headline":"Using React Hooks","image":"https://open-blog.dev/static/2cb9b06296b623620a429783b7e127f9/8539d/fishing.jpg","author":"Matthieu Lux","keywords":"react, hooks, recompose, javascript","publisher":{"@type":"Organization","name":"Open Blog","logo":{"@type":"ImageObject","url":"https://open-blog.dev/icons/icon-144x144.png"}},"datePublished":"26 March, 2019","dateCreated":"26 March, 2019","dateModified":"26 March, 2019","description":"The followup of my article describing React Hooks"}</script><link rel="shortcut icon" href="/icons/icon-48x48.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#3f51b5"><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=48fdfc2a19f4008982a971a4393fc87b"><link rel="sitemap" type="application/xml" href="/sitemap.xml"><link rel="alternate" type="application/rss+xml" title="Open blog" href="/rss.xml"><link as="script" rel="preload" href="/component---src-templates-blog-post-js-fe4b5ce51088862f1e8b.js"><link as="script" rel="preload" href="/1-176213520d534cda9cb6.js"><link as="script" rel="preload" href="/app-596e68a8093cbd5c6bb9.js"><link as="script" rel="preload" href="/styles-359065255d63fd2c3f9a.js"><link as="script" rel="preload" href="/webpack-runtime-b6b15bf61da6d599fe8d.js"><link as="fetch" rel="preload" href="/static/d/142/path---posts-swiip-using-react-hooks-6-b-6-a7a-MkAz2MR52RTkgCf3eRYijJDAfM.json" crossorigin="use-credentials"><style amp-custom>pre::-webkit-scrollbar{width:14px}pre::-webkit-scrollbar-track{background-color:#6272a4;border-radius:0}pre::-webkit-scrollbar-thumb{background-color:#bd93f9;border-radius:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:#282936;text-shadow:none;font-family:PT Mono,Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background-color:#5a5f80}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background-color:#5a5f80}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:#282936;border-radius:.5em;padding:1em;margin:.5em 0;overflow:auto;height:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#282936}:not(pre)>code[class*=language-]{padding:4px 7px;border-radius:.3em;white-space:normal}.limit-300{height:300px}.limit-400{height:400px}.limit-500{height:500px}.limit-600{height:600px}.limit-700{height:700px}.limit-800{height:800px}.token.comment{color:#6272a4}.token.prolog{color:#cfcfc2}.token.tag{color:#dc68aa}.token.entity{color:#8be9fd}.token.atrule{color:#62ef75}.token.url{color:#66d9ef}.token.selector{color:#cfcfc2}.token.string{color:#f1fa8c}.token.property{color:#ffb86c}.token.important{color:#ff79c6;font-weight:700}.token.punctuation{color:#e6db74}.token.number{color:#bd93f9}.token.function{color:#50fa7b}.token.class-name{color:#ffb86c}.token.keyword{color:#ff79c6}.token.boolean{color:#ffb86c}.token.operator{color:#8be9fd}.token.char{color:#ff879d}.token.regex,.token.variable{color:#50fa7b}.token.constant,.token.symbol{color:#ffb86c}.token.builtin{color:#ff79c6}.token.attr-value{color:#7ec699}.token.deleted,.token.namespace{color:#e2777a}.token.bold{font-weight:700}.token.italic{font-style:italic}.token{color:#ff79c6}.langague-c .token.string,.langague-cpp .token.string{color:#8be9fd}.language-css .token.selector{color:#50fa7b}.language-css .token.property{color:#ffb86c}.language-java .token.class-name,.language-java span.token.class-name{color:#8be9fd}.language-markup .token.attr-value{color:#66d9ef}.language-markup .token.tag{color:#50fa7b}.language-objectivec .token.property{color:#66d9ef}.language-objectivec .token.string{color:#50fa7b}.language-php .token.boolean{color:#8be9fd}.language-php .token.function{color:#ff79c6}.language-php .token.keyword{color:#66d9ef}.language-ruby .token.symbol{color:#8be9fd}.language-ruby .token.class-name{color:#cfcfc2}pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre.line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}div.code-toolbar{position:relative}div.code-toolbar>.toolbar{position:absolute;top:.3em;right:.2em;-webkit-transition:opacity .3s ease-in-out;transition:opacity .3s ease-in-out;opacity:0}div.code-toolbar:hover>.toolbar{opacity:1}div.code-toolbar>.toolbar .toolbar-item{display:inline-block;padding-right:20px}div.code-toolbar>.toolbar a{cursor:pointer}div.code-toolbar>.toolbar button{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;padding:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}div.code-toolbar>.toolbar a,div.code-toolbar>.toolbar button,div.code-toolbar>.toolbar span{color:#ccc;font-size:.8em;padding:.5em;background:#6272a4;border-radius:.5em}div.code-toolbar>.toolbar a:focus,div.code-toolbar>.toolbar a:hover,div.code-toolbar>.toolbar button:focus,div.code-toolbar>.toolbar button:hover,div.code-toolbar>.toolbar span:focus,div.code-toolbar>.toolbar span:hover{color:inherit;text-decoration:none;background-color:var(--verde)}span.token>a{color:#f1fa8c}:not(pre)>code[class*=language-text],pre[class*=language-text]{background-color:#efefef;color:#282936}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{font-style:italic;padding:.5rem 1.45rem;margin:0 0 1.45rem;border-left:3px solid #3f51b5}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:0 0;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.article-item{display:flex}.article-item>header{margin-right:.5rem}.article-item>picture{align-self:center;flex-grow:0;max-width:200px;height:100%;width:100%}.article-item__title:hover{color:#3f51b5}@media screen and (max-width:640px){.article-item>picture{display:none}}.author{display:flex;margin-bottom:2rem}.author>.author__description{padding-left:16px}.author__profile{width:100px;height:auto;border-radius:50%}.author__name{margin:0}.author__bio{margin:8px 0}.comment-item{display:flex;padding:.8rem;border:2px dotted #3f51b5;border-radius:4px}.comment-item__profile{width:40px;height:40px;border-radius:50%}.comment-item__name{font-size:1rem;font-weight:400;font-style:italic}.comment-item__description{margin-left:1rem}.comment-list{display:flex;flex-direction:column}.comment-list__action{align-self:center;display:block;padding:.8rem;background-color:#3f51b5;color:#fff;text-decoration:none;border-radius:4px;font-weight:700}.presentation{display:flex;flex-direction:column;font-size:1.2rem}.presentation img{-o-object-fit:contain;object-fit:contain;height:144px}.presentation h1{text-align:center}</style><meta charset="utf-8"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header style="background:#3f51b5;margin-bottom:1.45rem"><nav style="display:flex;align-items:baseline;justify-content:space-between;margin:0 auto;max-width:960px;padding:1rem 1.0875rem"><h1 style="margin:0"><a style="color:white;text-decoration:none" href="https://medium.zenika.com/">Open Blog</a></h1><h2 style="margin:0"><a style="color:white;text-decoration:none" href="https://medium.zenika.com/contributing">Contribute</a></h2></nav></header><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><main><amp-img src="/static/2cb9b06296b623620a429783b7e127f9/4e245/fishing.webp" alt="hero" width="175" height="117" layout="responsive" srcset="/static/2cb9b06296b623620a429783b7e127f9/4e245/fishing.webp 175w,
/static/2cb9b06296b623620a429783b7e127f9/e09c6/fishing.webp 350w,
/static/2cb9b06296b623620a429783b7e127f9/5c04a/fishing.webp 700w,
/static/2cb9b06296b623620a429783b7e127f9/c99c7/fishing.webp 1050w,
/static/2cb9b06296b623620a429783b7e127f9/a42d5/fishing.webp 1400w,
/static/2cb9b06296b623620a429783b7e127f9/7a72d/fishing.webp 1600w" sizes="(max-width: 600px) 100vw, 600px" type="image/webp"><amp-img src="/static/2cb9b06296b623620a429783b7e127f9/87c5e/fishing.jpg" alt="hero" width="175" height="117" layout="responsive" srcset="/static/2cb9b06296b623620a429783b7e127f9/87c5e/fishing.jpg 175w,
/static/2cb9b06296b623620a429783b7e127f9/dec55/fishing.jpg 350w,
/static/2cb9b06296b623620a429783b7e127f9/13e10/fishing.jpg 700w,
/static/2cb9b06296b623620a429783b7e127f9/1e2f4/fishing.jpg 1050w,
/static/2cb9b06296b623620a429783b7e127f9/3dc2b/fishing.jpg 1400w,
/static/2cb9b06296b623620a429783b7e127f9/989b1/fishing.jpg 1600w" sizes="(max-width: 600px) 100vw, 600px" type="image/png"></amp-img><amp-img src="/static/2cb9b06296b623620a429783b7e127f9/13e10/fishing.jpg" alt="hero" width="700" height="466" layout="responsive" fallback style="width:100vw;max-height:50vh;object-fit:cover"></amp-img></amp-img><div><h1>Using React Hooks</h1><div><p>This is the follow-up of my first post <a href="https://open-blog.dev/posts/swiip/react-hooks-my-introduction/">React Hooks, my introduction</a>. If you don&#x2019;t know what hooks are or just want to start from the beginning please check this article first.</p>
<p>As promised, I have now used hooks on a PoC project: <a href="https://github.com/Swiip/pokemon-arena">pokemon-arena</a> and one in production: the <a href="https://www.zenika.com/">zenika.com</a> website (not open source, sorry, perhaps one day&#x2026;). I don&#x2019;t have a lot of feedbacks about the PoC but using hooks on a real project has opened new questions.</p>
<p>This post is the feedback of my experience with hooks regarding some developer perspectives such as: code-reuse, 3rd-party librairies and testing.</p>
<p>A last reminder about the fact that no one in the React team nor me is advising you to refactor your whole codebase like I did. It&#x2019;s just a new opt-in feature you can use if you want. I made the switch aggressively out of curiosity not because I needed it.</p>
<h2>Code reuse</h2>
<p>One of the major benefits provided by hooks is the ability to reuse code. As a user of <a href="https://github.com/acdlite/recompose">Recompose</a>, I was already able to reuse code as custom HoC. That was one of the most important reason I used it in the first place. Switching to hooks first allowed me to remove the library on itself then to convert all of my custom HoCs to custom hooks. It was pretty straightforward as I could replace them one for one with the same semantic.</p>
<p>Not a huge code reduction then but I was happy to see that I could keep the benefits while removing a library.</p>
<p>Let&#x2019;s see an example of component logic sharing. In zenika.com, there is a list of our agencies coming from a <a href="https://graphql.org/">GraphQL</a> request. I have a bit of logic (with <a href="https://redux.js.org/">Redux</a>) to shuffle the list not to present the same order every time (and make no one jealous &#x1F602;). But I use this list in two places on the website.</p>
<p>There is a few requirement for this feature. Load data only once for several uses, shuffle once to avoid having different results at each rendering (avoiding inconsistent rendering). And simply don&#x2019;t forget to use the shuffled list everytime (I mention it as I had the bug).</p>
<p>It quickly made sense to extract a custom hook gathering the logic of fetching data, launching the shuffle, then returning the list. With a custom hook, there is a lot of benefits :</p>
<ul>
<li>Other developers only have to think of using that hook to get the agencies list. They can forget about the shuffle logic.</li>
<li>Two different components will always use the same logic to access agencies list and can&#x2019;t behave differently.</li>
<li>It&#x2019;s great for testing and isolation of concern. The hook will be able to be tested isolated from any component checking only for the logic of fetching agencies. The components can suppose that the agencies from the hook is good and focus on their own logic about displaying them.</li>
</ul>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-apollo-hooks&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> gql <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;apollo-boost&quot;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> initAgencies<span class="token punctuation">,</span> selectAgency <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../agencies&quot;</span>
<span class="token keyword">import</span> useRedux <span class="token keyword">from</span> <span class="token string">&quot;./useRedux&quot;</span>
<span class="token keyword">import</span> useLoaded <span class="token keyword">from</span> <span class="token string">&quot;./useLoaded&quot;</span>

<span class="token keyword">const</span> agencyQuery <span class="token operator">=</span> gql<span class="token template-string"><span class="token string">`
  query Agencies { ... }
`</span></span>

<span class="token keyword">const</span> <span class="token function-variable function">useAgencies</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span>agencyQuery<span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    agencies<span class="token punctuation">,</span>
    selectedAgency<span class="token punctuation">,</span>
    dispatchInitAgencies<span class="token punctuation">,</span>
    dispatchSelectAgency<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRedux</span><span class="token punctuation">(</span>
    <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      agencies<span class="token punctuation">:</span> state<span class="token punctuation">.</span>agencies<span class="token punctuation">.</span>agencies<span class="token punctuation">,</span>
      selectedAgency<span class="token punctuation">:</span> state<span class="token punctuation">.</span>agencies<span class="token punctuation">.</span>selectedAgency<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">dispatchInitAgencies</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">initAgencies</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>data<span class="token punctuation">.</span>agencies<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function-variable function">dispatchSelectAgency</span><span class="token punctuation">:</span> <span class="token parameter">agency</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">selectAgency</span><span class="token punctuation">(</span>agency<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>query<span class="token punctuation">.</span>data<span class="token punctuation">.</span>agencies<span class="token punctuation">]</span>
  <span class="token punctuation">)</span>

  <span class="token function">useLoaded</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatchInitAgencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> agencies<span class="token punctuation">,</span> selectedAgency<span class="token punctuation">,</span> selectAgency<span class="token punctuation">:</span> dispatchSelectAgency <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useAgencies</code></pre></div>
<p>We can also imagine guidelines in a project (even if I didn&#x2019;t go that far) where the direct use of a data related hook like mine for GraphQL is prohibited in the components in profit of always using a custom hook. In that case, we would be able to fully isolate the data layer and to add logic like my shuffle or even changing the data framework without touching the components.</p>
<h2>Third parties</h2>
<p>With my own experience of switching from HoCs to hooks most of the time passed was not about converting lots of code to the new API but in finding and configuring new third party libraries.</p>
<p>I allow myself a bit of a digression. That&#x2019;s typical in many structural evolutions. We estimate not enough time to deal with new libraries and too much about simple refactorings. But that&#x2019;s another topic.</p>
<p>Let&#x2019;s put some context. Zenika.com is a corporate website with not a lot of logic but has to deal with SSR, content and i18n. The main libraries I used besides React are: <a href="https://nextjs.org/">Next</a>, <a href="https://www.apollographql.com/">Apollo</a>, <a href="https://redux.js.org/">Redux</a> and <a href="https://www.i18next.com/">i18next</a>. You don&#x2019;t necessarily use the same ones but they covers most typical cases.</p>
<p><a class="gatsby-resp-image-link" href="https://medium.zenika.com/static/c53876818406959d79bccb6fb03a7f52/135ae/next.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 300px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAA9ElEQVQoz6WTOQvCQBCFExGDBg8sBBFBUDw6MQYsvCWFYqF4YCOawkYC/glrf7Nv4QXGEMXowMcMu7NvZjcTTYtuOr0JDO1P88VSoBTloKqeAWmQDOzFwAjkQYI5pky4i0RlHeCCMZgDCzgif0DBIbiBFehKwQcP+aaEqoGuZsAGde77tmeHL7YDbdASgi6LTECB62fgMY7Tb0E2KHiiX9P3wRIU2ZEp8rzA2U2Y4IW+wk57IVdW79QAZXAQ6yrOMVY3vGrsxrcmqx75IRZ8v6nIUXGNscMRMihoh42Mxarmm7GRE/GVJaMOrRh6/dNg//RbPQH89ROomuVDJQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;"></span>
    <amp-img src="/static/c53876818406959d79bccb6fb03a7f52/50512/next.webp" alt="Next.js" width="163" height="98" layout="responsive" srcset="/static/c53876818406959d79bccb6fb03a7f52/50512/next.webp 163w,
/static/c53876818406959d79bccb6fb03a7f52/bc722/next.webp 300w" sizes="(max-width: 300px) 100vw, 300px" type="image/webp"><amp-img src="/static/c53876818406959d79bccb6fb03a7f52/19bd1/next.png" alt="Next.js" width="163" height="98" layout="responsive" srcset="/static/c53876818406959d79bccb6fb03a7f52/19bd1/next.png 163w,
/static/c53876818406959d79bccb6fb03a7f52/135ae/next.png 300w" sizes="(max-width: 300px) 100vw, 300px" type="image/png"></amp-img><amp-img src="/static/c53876818406959d79bccb6fb03a7f52/135ae/next.png" alt="Next.js" width="300" height="181" layout="responsive" fallback class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" title></amp-img></amp-img>
  </span>
  </a></p>
<blockquote>
<p>Next doesn&#x2019;t provide support for hooks yet.</p>
</blockquote>
<p>That sentence doesn&#x2019;t have any real sense but I kept it knowingly to open the question of the meaning of supporting hooks. Hooks are just a new opt-in API so any existing framework or library is compatible. A library which supports hooks would only be a library which offers some custom hooks to use its feature.</p>
<p>Next is more a framework and has a small API which can be proposed as hooks. The principal one is the router which has to be accessed through a HoC <code class="language-text">withRouter</code> and where we would like to have also a <code class="language-text">useRouter</code>. The lead developer of Next <a href="https://twitter.com/timneutkens/status/1057053195044823040">already teased it on twitter</a>, also, there should be a way to add it manually.</p>
<p>But I chose to kept it as an example of cohabitation. I still use the official <code class="language-text">withRouter</code> with no problem in a middle of an app which now exclusively uses hooks and almost any other HoC.</p>
<p>I asked myself another question about removing HoCs with Next but it&#x2019;s a side question which I will only brush here. To configure frameworks like Apollo or Redux in Next, there is the use of HoCs on the <code class="language-text">_app.js</code> component. I tried to remove those HoCs for some kind of &#x201C;no HoC extremism&#x201D; and failed. Indeed, these HoCs are more complicated as they have to handle server side and browser side. This is just a reminder that HoC are still an interesting concept which could keep some value even with hooks.</p>
<p><a class="gatsby-resp-image-link" href="https://medium.zenika.com/static/5d8b5d6f9d408e6c8bef96dd6b29744b/51b71/i18next.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 367px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.32970027247956%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQY021RTUsCURSd/9IPaBVE61at20n7ggjaFLSJaJPQIpLKIDRbKGIKIpQwUtJYI2Ojg5MfaQUlMU+f2jznQ2ee4/QsDCEPd3Huxzlc7qUGto06SEYyIb8gxBqMYE/G4CcoMrga8Do8xxhjeyiz+iOJNab98xm3ox4EftrrmvIcXqdTJBcgOCsKrvwj35A22dtsAyimKWkKadV1jXDZ6HX72FcWcxBQdVWZC1/Mhn2lFiQTly/l00LOyTFOnp0Jne9wzBpDrzOJI5FfiAUPBG45Gd/j2aVEzF8pUPT72/YdvXFzFXl9JuJgtURc3SLvzLKL8cgWm9wXuJOn7EoyPh/1ByoFBx3dzaRIxVvKU/6y2Gy3EJJD1aKGsWoa7V4X6pqGTaFZ7xgG1HU4XNiofLWArtYU9NFBQFOLbUilwWcGgkxDupdq1r/rjr1gwsG+Aa8rbKKBpewZAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
    <amp-img src="/static/5d8b5d6f9d408e6c8bef96dd6b29744b/50512/i18next.webp" alt="i18next" width="163" height="61" layout="responsive" srcset="/static/5d8b5d6f9d408e6c8bef96dd6b29744b/50512/i18next.webp 163w,
/static/5d8b5d6f9d408e6c8bef96dd6b29744b/aeba0/i18next.webp 325w,
/static/5d8b5d6f9d408e6c8bef96dd6b29744b/2b68e/i18next.webp 367w" sizes="(max-width: 367px) 100vw, 367px" type="image/webp"><amp-img src="/static/5d8b5d6f9d408e6c8bef96dd6b29744b/19bd1/i18next.png" alt="i18next" width="163" height="61" layout="responsive" srcset="/static/5d8b5d6f9d408e6c8bef96dd6b29744b/19bd1/i18next.png 163w,
/static/5d8b5d6f9d408e6c8bef96dd6b29744b/d3bcb/i18next.png 325w,
/static/5d8b5d6f9d408e6c8bef96dd6b29744b/51b71/i18next.png 367w" sizes="(max-width: 367px) 100vw, 367px" type="image/png"></amp-img><amp-img src="/static/5d8b5d6f9d408e6c8bef96dd6b29744b/51b71/i18next.png" alt="i18next" width="367" height="137" layout="responsive" fallback class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" title></amp-img></amp-img>
  </span>
  </a></p>
<p>If you don&#x2019;t know anything about i18next, it&#x2019;s a i18n library (as indicated by its name) not bound to React, I use the official wrapper <a href="https://react.i18next.com/">react-i18next</a>.</p>
<p>In that case, react-i18next already published a major version containing a hook API when I started my work. That was pretty amazing, not much libraries reflect frameworks evolutions as quickly.</p>
<p>Hooks migration basically took the shape of a library update with its lot of breaking changes. But basically, switching from the HoC <code class="language-text">withNamespace</code> to the Hook <code class="language-text">useTranslation</code> was quite easy.</p>
<p><a class="gatsby-resp-image-link" href="https://medium.zenika.com/static/9a051b8ceb87d08d3af6d0fce9ed94f3/566ce/redux-apollo.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 63.63636363636363%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB8ElEQVQ4y5WT72/SQBjH+XvdfwDzhe9IkAhxRn1BlphlDmOyaRRfbMWoZJoMzBpgpvxYq53lRymlMEcpvfvau7ZQGnzhk1ye3t1zn/vefa8JeEG9CBLLfMgfB1zX5Y1NsUYI4S3shy3gIBECvCAsW8YcamtC3SXBmu8HA2G9YGtORBSS5cKlPy4GaJz3qSZbvEA4E1Aul1cwRVEgSdIGJJxbKaTEBzJll581tC9HtCqocB1g9/4udu7tIJvNolAoIJ1OI5lMolQqIZ/P46hYXME4MFS8dAhpfddp81sfUm1IxYqGm47lLTjE3uM9pFIpDs3lcshkMhzMMttkAxh0mGbSU6a0Kxq4ro9ptz7CzLQRj/B4zKj4WBRIA2epYU7xx57TaHHU1bgRcacTkacCsdmGovZoU5LRbMn43wju0H9y8i+N9vUxFSo1eEDaUW6QfnKAgT7G6ZcLnFWqGBom2rKKu7kN8arNIa/ff8R5tb4GEuILbEjXmNsLPHi0j8OTU3R//sbDZy9hTW+x/6qE4luBwwpH7zAcmXj64hi9oYHnB29w/OHT6h5DhZhYM3ytNTC7veOFDBgGA+jGhH/Lag8Lx4GqDWAvHF7LNo2bwgd070jiVYerNb0NuJtb/o5/3d+Gwm3F29wMHWdXxXPM/b+cMdCwzgjIOQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;"></span>
    <amp-img src="/static/9a051b8ceb87d08d3af6d0fce9ed94f3/50512/redux-apollo.webp" alt="Redux and Apollo" width="163" height="104" layout="responsive" srcset="/static/9a051b8ceb87d08d3af6d0fce9ed94f3/50512/redux-apollo.webp 163w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/aeba0/redux-apollo.webp 325w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/001d9/redux-apollo.webp 650w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/97fd0/redux-apollo.webp 975w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/4c0d2/redux-apollo.webp 1100w" sizes="(max-width: 650px) 100vw, 650px" type="image/webp"><amp-img src="/static/9a051b8ceb87d08d3af6d0fce9ed94f3/19bd1/redux-apollo.png" alt="Redux and Apollo" width="163" height="104" layout="responsive" srcset="/static/9a051b8ceb87d08d3af6d0fce9ed94f3/19bd1/redux-apollo.png 163w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/d3bcb/redux-apollo.png 325w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/dbb61/redux-apollo.png 650w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/6b691/redux-apollo.png 975w,
/static/9a051b8ceb87d08d3af6d0fce9ed94f3/566ce/redux-apollo.png 1100w" sizes="(max-width: 650px) 100vw, 650px" type="image/png"></amp-img><amp-img src="/static/9a051b8ceb87d08d3af6d0fce9ed94f3/dbb61/redux-apollo.png" alt="Redux and Apollo" width="650" height="414" layout="responsive" fallback class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" title></amp-img></amp-img>
  </span>
  </a></p>
<p>I coupled these two libraries not because they are alike in any way but because my journey for using them with hooks was very similar. In both cases, the official library didn&#x2019;t support hooks yet (<a href="https://github.com/apollographql/react-apollo">react-apollo</a> and <a href="https://github.com/reduxjs/react-redux">react-redux</a>) intends to (for <a href="https://github.com/apollographql/react-apollo/issues/2539">Apollo</a> and for <a href="https://github.com/reduxjs/react-redux/issues/1179">Redux</a>) but there is alternative implementations which already exists (<a href="https://github.com/trojanowski/react-apollo-hooks">react-apollo-hooks</a> and <a href="https://github.com/facebookincubator/redux-react-hook">react-redux-hooks</a>).</p>
<p>I found both alternate libraries quite stable already and was able to use their hooks pretty quickly. In both cases, I mostly struggled with their Next wrapper which is not directly related to hooks. Once the wrapper worked server side, client side and handled the hidration (mechanism of restarting React on an existing markup), the rest went smoothly.</p>
<p>The only question left was about the hook API. The one from react-redux-hook has (at least at this moment) a really low level API forcing you to handle callback memoization by yourself each time. I was able to produce a wrapper more suited to what I wanted very quickly. <a href="https://github.com/facebookincubator/redux-react-hook/pull/37">We submitted a PR with a friend</a> which will not be merged as is but the API should evolve soon.</p>
<h2>Memoization</h2>
<p>In my experience of using hooks, there was only one pain point worth to mention deeper. It&#x2019;s about memoization. You have to understand that writing your logic inside the render method is cool but you can&#x2019;t fully forget that it&#x2019;s a function which will be called at every render of React and there can be a lot.</p>
<p>To avoid running some code too often, the entry point is the <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code class="language-text">useMemo</code></a> hook. It takes a function as first argument and an array as second. The array is the list of dependencies of the function. React will check by reference each of them and call the function only when there is a difference. The return value of the hook will be the return value of the function in first argument. (For the <a href="https://fr.vuejs.org/index.html">Vue</a> developers, <code class="language-text">useMemo</code> looks a lot like a <code class="language-text">computed</code> property)</p>
<p>This way, you can control precisely when some code will be run or not and save some calculations but the pattern on itself is used in several other hooks. The second to mention is <code class="language-text">useCallback</code> which is basically the same as <code class="language-text">useMemo</code> for functions. But the most important to mention is useEffect.</p>
<p>If you&#x2019;re like me, you&#x2019;ll suppose <code class="language-text">useEffect</code> is like <code class="language-text">componentDidMount</code> and you will be surprised to see that it&#x2019;s ran way more than once. It&#x2019;s in fact more the equivalent of <code class="language-text">componentDidUpdate</code>. By default, it&#x2019;s ran for each change in the components and it&#x2019;s often not what you want. <code class="language-text">useEffect</code> takes an array as second argument which is the same semantic as <code class="language-text">useMemo</code> and will allow you to control when the callback will be ran.</p>
<p>It works pretty well but to be honest, having to care about when each code is ran considering each reference I passed in lists in second argument can be boring and error prone. I ended up many times putting a log in my <code class="language-text">useEffect</code> to check if it was called when I wanted and no more.</p>
<h2>Testing</h2>
<p>There is a topic about hooks where I&#x2019;ve seen everything and its opposite, it&#x2019;s about testing. In my project, I updated all my tests and there is what I found.</p>
<p>First, there is the separation of concern. Being able to extract logic code from components and localize it in a dedicated file is, by essence, great for testing. Testing a custom hook is quite easy, not much to say, you don&#x2019;t have component or rendering to manage, you just have to check the logic of the hook. It&#x2019;s easier than testing HoC as you don&#x2019;t have to handle a dumb component to wrap.</p>
<p>During a moment when hooks was just released, it was said that it was not working in tests. In fact there was a bug in <a href="https://airbnb.io/enzyme/">Enzyme</a> that lots of people are using but it has been quickly fixed. There is still no direct support with utility functions for hooks but at least you can test a component with hooks as any other.</p>
<p>I think, there is two major ways to test a component with hooks.</p>
<ul>
<li>The way with a real mount: no mocking of hooks and interact with the component in a way which triggers hooks and tests the result.</li>
<li>The other way is to <a href="https://airbnb.io/enzyme/docs/api/shallow.html">shallow the rendering</a> but in this case, at least today with Enzyme, you have to mock all hooks. It could seem to be difficult but mocking hooks is quite easy.</li>
</ul>
<p>Shallow rendering and mocking hooks is the way I chose and I was pretty happy with it. Mocking all hooks allows me to perfectly isolate my components and each frameworks like Apollo or Redux considering my components are in charge of only rendering data and hooks are in charge of behaving as they should.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;enzyme&quot;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&quot;next/router&quot;</span>

<span class="token keyword">import</span> AgenciesMenu <span class="token keyword">from</span> <span class="token string">&quot;../AgenciesMenu&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> setAgencies<span class="token punctuation">,</span> selectAgency <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../../../logic/hooks/useAgencies&quot;</span>

<span class="token keyword">const</span> lyon <span class="token operator">=</span> <span class="token punctuation">{</span> slug<span class="token punctuation">:</span> <span class="token string">&quot;lyon&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> paris <span class="token operator">=</span> <span class="token punctuation">{</span> slug<span class="token punctuation">:</span> <span class="token string">&quot;paris&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> agencies <span class="token operator">=</span> <span class="token punctuation">[</span>lyon<span class="token punctuation">,</span> paris<span class="token punctuation">]</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;../../../logic/hooks/useAgencies&quot;</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;should match snapshot&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setAgencies</span><span class="token punctuation">(</span>agencies<span class="token punctuation">)</span>
  <span class="token keyword">const</span> cmp <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>AgenciesMenu <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>cmp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;should provide a select agency handler which call the action and route&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setAgencies</span><span class="token punctuation">(</span>agencies<span class="token punctuation">)</span>

  <span class="token keyword">const</span> cmp <span class="token operator">=</span> <span class="token function">shallow</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>AgenciesMenu <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> handleAgency <span class="token operator">=</span> cmp
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;AgenciesMenu__Item&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">&quot;onClick&quot;</span><span class="token punctuation">)</span>

  <span class="token function">handleAgency</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>selectAgency<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>Router<span class="token punctuation">.</span>push<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h2>Other remarks</h2>
<p>Using hooks, I made several other smaller remarks</p>
<ul>
<li>Heavy usage of HoCs blurs a lot what props your component is receiving or not. Props jump from one HoC to the next and you often end up with arguments in your functional components which are totally different of the one really needed in input. Hooks restore real props in your function declaration which helps readability.</li>
<li>One goal of removing HoCs was about to simplify the component tree of React. To be honest, it&#x2019;s better but not so much. Mainly because I use <a href="https://www.styled-components.com/">styled-components</a>,&#x201C;ok&#x201D;, but not only. There is a lot of components in a React app and each use of a context adds a layer and to be honest, it&#x2019;s still not really readable with hooks.</li>
</ul>
<p><a class="gatsby-resp-image-link" href="https://medium.zenika.com/static/e3919b15aadb24a9c7152c5997747773/2f950/hooks-tree.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.9375%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABJklEQVQoz4VR227CMAzlV0iaNIkTJzSll8HasgLa5TOmCaR9y7SHwaT97VyYpj1Ad3SUB9vHx3YmnHMNtn7aVNu7ctnIRDDGKMiT/zEZHs7Bh7xrQ1WEMoJHqXQqxZD5wytiyjGGcVY/9IvHvmqXCA5BqVRIIZQceO51WUxgU2bRFd2qaLuyzAOYiDaA8kbNQKFRY2KaTEiZLepy28/XLWbRgDNK8h8ko+Jhdy5EklV5vemrppkZFRwEC2R+8tdCiKvik55pi/6msbEA58FHCJlKJa0shRhzPoOKwjzW96ti3fo8akCjNcWnjJ//8Pf+F8RDAeM+C8VtXTYLulkwqTcpnY1odTrmTMMxllidvL/4456IxMMOjzv83OPHDt+e7WHvvl7dNwstZuwghQDKAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
    <amp-img src="/static/e3919b15aadb24a9c7152c5997747773/50512/hooks-tree.webp" alt="Component tree with hooks" width="163" height="80" layout="responsive" srcset="/static/e3919b15aadb24a9c7152c5997747773/50512/hooks-tree.webp 163w,
/static/e3919b15aadb24a9c7152c5997747773/aeba0/hooks-tree.webp 325w,
/static/e3919b15aadb24a9c7152c5997747773/001d9/hooks-tree.webp 650w,
/static/e3919b15aadb24a9c7152c5997747773/97fd0/hooks-tree.webp 975w,
/static/e3919b15aadb24a9c7152c5997747773/05607/hooks-tree.webp 1300w,
/static/e3919b15aadb24a9c7152c5997747773/ded3f/hooks-tree.webp 1600w" sizes="(max-width: 650px) 100vw, 650px" type="image/webp"><amp-img src="/static/e3919b15aadb24a9c7152c5997747773/19bd1/hooks-tree.png" alt="Component tree with hooks" width="163" height="80" layout="responsive" srcset="/static/e3919b15aadb24a9c7152c5997747773/19bd1/hooks-tree.png 163w,
/static/e3919b15aadb24a9c7152c5997747773/d3bcb/hooks-tree.png 325w,
/static/e3919b15aadb24a9c7152c5997747773/dbb61/hooks-tree.png 650w,
/static/e3919b15aadb24a9c7152c5997747773/6b691/hooks-tree.png 975w,
/static/e3919b15aadb24a9c7152c5997747773/91670/hooks-tree.png 1300w,
/static/e3919b15aadb24a9c7152c5997747773/2f950/hooks-tree.png 1600w" sizes="(max-width: 650px) 100vw, 650px" type="image/png"></amp-img><amp-img src="/static/e3919b15aadb24a9c7152c5997747773/dbb61/hooks-tree.png" alt="Component tree with hooks" width="650" height="318" layout="responsive" fallback class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" title></amp-img></amp-img>
  </span>
  </a></p>
<ul>
<li>Small pain but real pain. Switching from a real dumb functional component to a one with hooks asks you to add a function body (adding braces) and a return statement for the markup which is a pain to change in every single file.</li>
<li>I surely spent more time about updating libraries which use other new APIs of React than hooks. I think mostly of <a href="https://reactjs.org/docs/code-splitting.html#suspense"><code class="language-text">Suspense</code></a> and the <a href="https://reactjs.org/docs/context.html">new context API</a>. It&#x2019;s just that these new libraries versions which offers hooks are more recent and use &#x201C;also&#x201D; the last features.</li>
<li>Perhaps you see this coming before but I didn&#x2019;t use a lots of native React hooks. Some <code class="language-text">useEffect</code> and some <code class="language-text">useState</code>. But in the end, the hooks I used the most are <code class="language-text">useRedux</code>, <code class="language-text">useQuery</code> (Apollo) and <code class="language-text">useTranslations</code> (i18next).</li>
</ul>
<h2>Conclusion</h2>
<p>I&#x2019;m still fan of hooks. It didn&#x2019;t profoundly change my code because I anticipated the move through HoCs. But now, I can profit of the code reuse of sharing component logic as a part of the framework and not some trick I&#x2019;m using and others doesn&#x2019;t understand.</p>
<p><a class="gatsby-resp-image-link" href="https://medium.zenika.com/static/168dfbcb101d756657c5515667a4689a/8179c/climbing.jpg" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.1875%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAFFsLGdUUUf/8QAGRABAQEBAQEAAAAAAAAAAAAAAQIDABES/9oACAEBAAEFAs5eMyX6em2TPRni/T//xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQMBAT8BNX//xAAWEQADAAAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8BEX//xAAZEAACAwEAAAAAAAAAAAAAAAARIQABAhD/2gAIAQEABj8CUNU+DM0Wef/EABkQAAMBAQEAAAAAAAAAAAAAAAABMRFBIf/aAAgBAQABPyFvayntQnW9FlGKmC7KeCdKLS8qP//aAAwDAQACAAMAAAAQZA//xAAXEQEBAQEAAAAAAAAAAAAAAAABACFR/9oACAEDAQE/EGm3t//EABYRAQEBAAAAAAAAAAAAAAAAAAAhUf/aAAgBAgEBPxBTH//EAB0QAQADAAMAAwAAAAAAAAAAAAEAESFBUWExgaH/2gAIAQEAAT8Q0IoqvvA8srHZ0H18Sq29Ai9VaX9Y2ha3jYx0IKdT/9k=&apos;); background-size: cover; display: block;"></span>
    <amp-img src="/static/168dfbcb101d756657c5515667a4689a/50512/climbing.webp" alt="Climber photo by Chen Hu on Unsplash" width="163" height="118" layout="responsive" srcset="/static/168dfbcb101d756657c5515667a4689a/50512/climbing.webp 163w,
/static/168dfbcb101d756657c5515667a4689a/aeba0/climbing.webp 325w,
/static/168dfbcb101d756657c5515667a4689a/001d9/climbing.webp 650w,
/static/168dfbcb101d756657c5515667a4689a/97fd0/climbing.webp 975w,
/static/168dfbcb101d756657c5515667a4689a/05607/climbing.webp 1300w,
/static/168dfbcb101d756657c5515667a4689a/ded3f/climbing.webp 1600w" sizes="(max-width: 650px) 100vw, 650px" type="image/webp"><amp-img src="/static/168dfbcb101d756657c5515667a4689a/aca85/climbing.jpg" alt="Climber photo by Chen Hu on Unsplash" width="163" height="118" layout="responsive" srcset="/static/168dfbcb101d756657c5515667a4689a/aca85/climbing.jpg 163w,
/static/168dfbcb101d756657c5515667a4689a/0954f/climbing.jpg 325w,
/static/168dfbcb101d756657c5515667a4689a/a111b/climbing.jpg 650w,
/static/168dfbcb101d756657c5515667a4689a/ce471/climbing.jpg 975w,
/static/168dfbcb101d756657c5515667a4689a/bee4e/climbing.jpg 1300w,
/static/168dfbcb101d756657c5515667a4689a/8179c/climbing.jpg 1600w" sizes="(max-width: 650px) 100vw, 650px" type="image/jpeg"></amp-img><amp-img src="/static/168dfbcb101d756657c5515667a4689a/a111b/climbing.jpg" alt="Climber photo by Chen Hu on Unsplash" width="650" height="469" layout="responsive" fallback class="gatsby-resp-image-image" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;" title></amp-img></amp-img>
  </span>
  </a></p>
<p>As you would expect, it&#x2019;s still fresh, several libraries are not ready yet and others are still in transition. But I&#x2019;m pretty convinced that hooks are here for long and will progressively become standard in the React community.</p>
<blockquote>
<p>Thanks to Nicolas Cuillery, J&#xE9;r&#xE9;mie Picard, Marvin Frachet, and Mouss.</p>
</blockquote></div></div><hr><section class="author"><amp-img src="https://avatars3.githubusercontent.com/u/475895?v=4" alt="Matthieu Lux" width="460" height="460" layout="responsive" class="author__profile"></amp-img><div class="author__description"><h3 class="author__name">Matthieu Lux<a href="https://github.com/Swiip">(@<!-- -->Swiip<!-- -->)</a></h3><div class="author__bio"><div>Developer <a class="user-mention" data-hovercard-type="organization" data-hovercard-url="/orgs/ProtonMail/hovercard" href="https://github.com/ProtonMail">@ProtonMail</a>  // Ex <g-emoji class="g-emoji" alias="avocado" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f951.png">&#x1F951;</g-emoji> <a class="user-mention" data-hovercard-type="organization" data-hovercard-url="/orgs/Zenika/hovercard" href="https://github.com/Zenika">@Zenika</a>  #Web and #JavaScript technologies // #React #Vue #Angular #Node // Organizer <a class="user-mention" data-hovercard-type="organization" data-hovercard-url="/orgs/lyonjs/hovercard" href="https://github.com/lyonjs">@lyonjs</a></div></div></div></section><aside><h3>Other articles from this author:</h3><nav><ul style="margin:0;list-style:none"><li><a style="text-decoration:none;color:black" href="https://medium.zenika.com/posts/swiip/react-hooks-my-introduction/"></a><article class="article-item"><a style="text-decoration:none;color:black" href="https://medium.zenika.com/posts/swiip/react-hooks-my-introduction/"></a><header><a style="text-decoration:none;color:black" href="https://medium.zenika.com/posts/swiip/react-hooks-my-introduction/"><h3 class="article-item__title" style="margin:0.5rem 0">&#x1F1EC;&#x1F1E7;<!-- --> <!-- -->React Hooks, my introduction</h3><span></span></a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/react">#<!-- -->react</a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/hooks">#<!-- -->hooks</a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/recompose">#<!-- -->recompose</a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/javascript">#<!-- -->javascript</a>&#xA0;by<!-- --> <a href="https://medium.zenika.com/authors/swiip">Matthieu Lux</a><p>How to write an article about React Hooks when so many has already been published? This is the question I asked myself before starting this&#x2026;</p></header><amp-img src="/static/d3cd3781ea1c16ee8df46c10cd0b2009/17370/hook.webp" alt="hero" width="50" height="20" layout="responsive" srcset="/static/d3cd3781ea1c16ee8df46c10cd0b2009/17370/hook.webp 50w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/74729/hook.webp 100w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/1932c/hook.webp 200w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/9ea76/hook.webp 300w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/f4957/hook.webp 400w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/1988e/hook.webp 637w" sizes="30vw" type="image/webp"><amp-img src="/static/d3cd3781ea1c16ee8df46c10cd0b2009/a911e/hook.jpg" alt="hero" width="50" height="20" layout="responsive" srcset="/static/d3cd3781ea1c16ee8df46c10cd0b2009/a911e/hook.jpg 50w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/954df/hook.jpg 100w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/d278e/hook.jpg 200w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/c83a6/hook.jpg 300w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/8539d/hook.jpg 400w,
/static/d3cd3781ea1c16ee8df46c10cd0b2009/f43d0/hook.jpg 637w" sizes="30vw" type="image/png"></amp-img><amp-img src="/static/d3cd3781ea1c16ee8df46c10cd0b2009/d278e/hook.jpg" alt="hero" width="200" height="79" layout="responsive" fallback class="article-item__picture"></amp-img></amp-img></article></li><li><a style="text-decoration:none;color:black" href="https://medium.zenika.com/posts/swiip/the-weight-of-js/"></a><article class="article-item"><a style="text-decoration:none;color:black" href="https://medium.zenika.com/posts/swiip/the-weight-of-js/"></a><header><a style="text-decoration:none;color:black" href="https://medium.zenika.com/posts/swiip/the-weight-of-js/"><h3 class="article-item__title" style="margin:0.5rem 0">&#x1F1EC;&#x1F1E7;<!-- --> <!-- -->The Weight of JS</h3><span></span></a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/javascript">#<!-- -->javascript</a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/minification">#<!-- -->minification</a><a style="margin:0 0.2rem;text-decoration:none;color:#3f51b5" href="https://medium.zenika.com/tags/compression">#<!-- -->compression</a>&#xA0;by<!-- --> <a href="https://medium.zenika.com/authors/swiip">Matthieu Lux</a><p>There are two primary measures for JS performance. The first one, which is attracting all the attention, is DOM updating which is almost&#x2026;</p></header><amp-img src="/static/2d50e1a9da7485815ca03e5a320c51db/17370/victor-freitas-Yuv-iwByVRQ-unsplash.webp" alt="hero" width="50" height="24" layout="responsive" srcset="/static/2d50e1a9da7485815ca03e5a320c51db/17370/victor-freitas-Yuv-iwByVRQ-unsplash.webp 50w,
/static/2d50e1a9da7485815ca03e5a320c51db/74729/victor-freitas-Yuv-iwByVRQ-unsplash.webp 100w,
/static/2d50e1a9da7485815ca03e5a320c51db/1932c/victor-freitas-Yuv-iwByVRQ-unsplash.webp 200w,
/static/2d50e1a9da7485815ca03e5a320c51db/9ea76/victor-freitas-Yuv-iwByVRQ-unsplash.webp 300w,
/static/2d50e1a9da7485815ca03e5a320c51db/f4957/victor-freitas-Yuv-iwByVRQ-unsplash.webp 400w,
/static/2d50e1a9da7485815ca03e5a320c51db/f6f8b/victor-freitas-Yuv-iwByVRQ-unsplash.webp 2000w" sizes="30vw" type="image/webp"><amp-img src="/static/2d50e1a9da7485815ca03e5a320c51db/a911e/victor-freitas-Yuv-iwByVRQ-unsplash.jpg" alt="hero" width="50" height="24" layout="responsive" srcset="/static/2d50e1a9da7485815ca03e5a320c51db/a911e/victor-freitas-Yuv-iwByVRQ-unsplash.jpg 50w,
/static/2d50e1a9da7485815ca03e5a320c51db/954df/victor-freitas-Yuv-iwByVRQ-unsplash.jpg 100w,
/static/2d50e1a9da7485815ca03e5a320c51db/d278e/victor-freitas-Yuv-iwByVRQ-unsplash.jpg 200w,
/static/2d50e1a9da7485815ca03e5a320c51db/c83a6/victor-freitas-Yuv-iwByVRQ-unsplash.jpg 300w,
/static/2d50e1a9da7485815ca03e5a320c51db/8539d/victor-freitas-Yuv-iwByVRQ-unsplash.jpg 400w,
/static/2d50e1a9da7485815ca03e5a320c51db/883ab/victor-freitas-Yuv-iwByVRQ-unsplash.jpg 2000w" sizes="30vw" type="image/png"></amp-img><amp-img src="/static/2d50e1a9da7485815ca03e5a320c51db/d278e/victor-freitas-Yuv-iwByVRQ-unsplash.jpg" alt="hero" width="200" height="97" layout="responsive" fallback class="article-item__picture"></amp-img></amp-img></article></li></ul></nav></aside></main></div></div></div></body></html>